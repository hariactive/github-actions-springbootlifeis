name: Spring Boot CI/CD Pipeline

on: 
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

env:
  DOCKER_IMAGE: springboot-lifeis

jobs:
  build-and-test:
    name: Build and Test Spring Boot App
    runs-on: ubuntu-latest
    
    steps:
    # Step 1: Checkout code
    - name: Checkout code
      uses: actions/checkout@v4
      
    # Step 2: Setup Java
    - name: Set up Java 21
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'
        
    # Step 3: Cache Maven dependencies (SPEED BOOST! âš¡)
    - name: Cache Maven dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          maven-
          
    # Step 4: Build application
    - name: Build with Maven
      run: mvn clean compile -Dmaven.compiler.source=21 -Dmaven.compiler.target=21
      
    # Step 5: Run tests
    - name: Run tests
      run: mvn test
      
    # Step 6: Package JAR
    - name: Package application
      run: mvn package -DskipTests
      
    # Step 7: Upload JAR as artifact
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v3
      with:
        name: springboot-app-jar
        path: target/*.jar